# Cron å®šæ—¶ä»»åŠ¡é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ä¸ºäº†è®©æ–°é—»æ•°æ®æ¯å¤©è‡ªåŠ¨æ›´æ–°ï¼Œä½ éœ€è¦é…ç½®ä¸€ä¸ª cron å®šæ—¶ä»»åŠ¡æ¥å®šæœŸè¿è¡Œçˆ¬è™«ã€‚

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

åº”ç”¨å·²ç»æ·»åŠ äº†**è‡ªåŠ¨æ•°æ®é‡è½½æœºåˆ¶**ï¼š
- âœ… Flaskåº”ç”¨æ¯5åˆ†é’Ÿè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ•°æ®æ–‡ä»¶
- âœ… å‘ç°æ–°æ–‡ä»¶åè‡ªåŠ¨é‡æ–°åŠ è½½åˆ°å†…å­˜
- âœ… å‰ç«¯ç”¨æˆ·æ— éœ€æ‰‹åŠ¨åˆ·æ–°å³å¯çœ‹åˆ°æœ€æ–°æ•°æ®

**ç°åœ¨åªéœ€è¦é…ç½®å®šæ—¶ä»»åŠ¡è®©çˆ¬è™«å®šæœŸè¿è¡Œå³å¯ï¼**

---

## ğŸš€ é…ç½®æ­¥éª¤

### ç¬¬1æ­¥ï¼šç¡®è®¤Pythonè™šæ‹Ÿç¯å¢ƒè·¯å¾„

é¦–å…ˆï¼Œæ‰¾åˆ°ä½ çš„é¡¹ç›®å’Œè™šæ‹Ÿç¯å¢ƒçš„ç»å¯¹è·¯å¾„ï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/solar_news_crawler

# æ˜¾ç¤ºé¡¹ç›®ç»å¯¹è·¯å¾„
pwd

# æ˜¾ç¤ºPythonè§£é‡Šå™¨è·¯å¾„ï¼ˆåœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼‰
which python
```

è®°ä¸‹è¿™ä¸¤ä¸ªè·¯å¾„ï¼Œåé¢ä¼šç”¨åˆ°ã€‚

**ç¤ºä¾‹è·¯å¾„**ï¼ˆè¯·æ›¿æ¢ä¸ºä½ çš„å®é™…è·¯å¾„ï¼‰ï¼š
- é¡¹ç›®è·¯å¾„ï¼š`/home/user/solar_news_crawler`
- Pythonè·¯å¾„ï¼š`/home/user/solar_news_crawler/venv/bin/python`

---

### ç¬¬2æ­¥ï¼šç¼–è¾‘ crontab

```bash
crontab -e
```

å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œä¼šæç¤ºé€‰æ‹©ç¼–è¾‘å™¨ï¼ˆæ¨èé€‰æ‹© nano æˆ– vimï¼‰ã€‚

---

### ç¬¬3æ­¥ï¼šæ·»åŠ å®šæ—¶ä»»åŠ¡

åœ¨æ‰“å¼€çš„æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆ**è¯·æ›¿æ¢è·¯å¾„ä¸ºä½ çš„å®é™…è·¯å¾„**ï¼‰ï¼š

#### æ–¹æ¡ˆAï¼šæ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œï¼ˆæ¨èï¼‰

```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œçˆ¬è™«å’Œç¿»è¯‘
0 2 * * * cd /home/user/solar_news_crawler/solar_news_crawler && /home/user/solar_news_crawler/venv/bin/python master_crawler.py now >> /var/log/solar-crawler.log 2>&1
```

#### æ–¹æ¡ˆBï¼šæ¯å¤©ä¸Šåˆ9ç‚¹è¿è¡Œ

```bash
# æ¯å¤©ä¸Šåˆ9ç‚¹è¿è¡Œçˆ¬è™«å’Œç¿»è¯‘
0 9 * * * cd /home/user/solar_news_crawler/solar_news_crawler && /home/user/solar_news_crawler/venv/bin/python master_crawler.py now >> /var/log/solar-crawler.log 2>&1
```

#### æ–¹æ¡ˆCï¼šæ¯12å°æ—¶è¿è¡Œä¸€æ¬¡

```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹å’Œä¸‹åˆ2ç‚¹è¿è¡Œ
0 2,14 * * * cd /home/user/solar_news_crawler/solar_news_crawler && /home/user/solar_news_crawler/venv/bin/python master_crawler.py now >> /var/log/solar-crawler.log 2>&1
```

#### æ–¹æ¡ˆDï¼šæ¯6å°æ—¶è¿è¡Œä¸€æ¬¡

```bash
# æ¯å¤©0ç‚¹ã€6ç‚¹ã€12ç‚¹ã€18ç‚¹è¿è¡Œ
0 */6 * * * cd /home/user/solar_news_crawler/solar_news_crawler && /home/user/solar_news_crawler/venv/bin/python master_crawler.py now >> /var/log/solar-crawler.log 2>&1
```

---

### ç¬¬4æ­¥ï¼šä¿å­˜å¹¶é€€å‡º

- **nano**: æŒ‰ `Ctrl+O` ä¿å­˜ï¼Œ`Ctrl+X` é€€å‡º
- **vim**: æŒ‰ `Esc`ï¼Œè¾“å…¥ `:wq`ï¼ŒæŒ‰å›è½¦

---

### ç¬¬5æ­¥ï¼šéªŒè¯ cron ä»»åŠ¡å·²æ·»åŠ 

```bash
# æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ crontab
crontab -l
```

ä½ åº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰æ·»åŠ çš„ä»»åŠ¡ã€‚

---

## ğŸ“ Crontab è¯­æ³•è¯´æ˜

```
åˆ†é’Ÿ å°æ—¶ æ—¥æœŸ æœˆä»½ æ˜ŸæœŸ å‘½ä»¤
```

| å­—æ®µ | å–å€¼èŒƒå›´ | è¯´æ˜ |
|------|---------|------|
| åˆ†é’Ÿ | 0-59 | ç¬¬å‡ åˆ†é’Ÿæ‰§è¡Œ |
| å°æ—¶ | 0-23 | ç¬¬å‡ å°æ—¶æ‰§è¡Œï¼ˆ0è¡¨ç¤ºå‡Œæ™¨ï¼‰ |
| æ—¥æœŸ | 1-31 | æ¯æœˆç¬¬å‡ å¤©æ‰§è¡Œ |
| æœˆä»½ | 1-12 | ç¬¬å‡ æœˆæ‰§è¡Œ |
| æ˜ŸæœŸ | 0-7 | æ˜ŸæœŸå‡ æ‰§è¡Œï¼ˆ0å’Œ7éƒ½è¡¨ç¤ºå‘¨æ—¥ï¼‰ |

### å¸¸ç”¨ç¤ºä¾‹

```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹
0 2 * * *

# æ¯å¤©ä¸Šåˆ9ç‚¹
0 9 * * *

# æ¯å¤©å‡Œæ™¨2ç‚¹å’Œä¸‹åˆ2ç‚¹
0 2,14 * * *

# æ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡
0 */6 * * *

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
0 * * * *

# æ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹
0 9 * * 1

# æ¯æœˆ1å·å‡Œæ™¨2ç‚¹
0 2 1 * *
```

---

## ğŸ” æµ‹è¯•å®šæ—¶ä»»åŠ¡

ä¸ç”¨ç­‰åˆ°å®é™…è¿è¡Œæ—¶é—´ï¼Œä½ å¯ä»¥ç«‹å³æµ‹è¯•ï¼š

### æ–¹æ³•1ï¼šæ‰‹åŠ¨è¿è¡Œä¸€æ¬¡çˆ¬è™«

```bash
cd /home/user/solar_news_crawler/solar_news_crawler
source ../venv/bin/activate
python master_crawler.py now
```

è¿™ä¼šç«‹å³æ‰§è¡Œçˆ¬è™«ï¼Œå®Œæˆåï¼š
1. æ£€æŸ¥ `output/individual/` ç›®å½•æ˜¯å¦ç”Ÿæˆäº†æ–°çš„JSONæ–‡ä»¶
2. ç­‰å¾…5åˆ†é’Ÿï¼ŒFlaskåº”ç”¨ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é‡è½½æ•°æ®
3. è®¿é—®å‰ç«¯é¡µé¢ï¼ŒæŸ¥çœ‹æ•°æ®æ˜¯å¦æ›´æ–°

### æ–¹æ³•2ï¼šä¸´æ—¶è®¾ç½®cronåœ¨å‡ åˆ†é’Ÿåè¿è¡Œ

```bash
# ä¸´æ—¶è®¾ç½®åœ¨å½“å‰æ—¶é—´+5åˆ†é’Ÿåè¿è¡Œ
# å‡è®¾ç°åœ¨æ˜¯10:30ï¼Œå°±è®¾ç½®ä¸º10:35è¿è¡Œ
crontab -e
```

æ·»åŠ ï¼š
```bash
35 10 * * * cd /home/user/solar_news_crawler/solar_news_crawler && /home/user/solar_news_crawler/venv/bin/python master_crawler.py now >> /var/log/solar-crawler-test.log 2>&1
```

ç­‰å¾…å‡ åˆ†é’Ÿåæ£€æŸ¥æ—¥å¿—ï¼š
```bash
tail -f /var/log/solar-crawler-test.log
```

æµ‹è¯•å®Œæˆåè®°å¾—åˆ é™¤æµ‹è¯•ä»»åŠ¡ï¼Œæ”¹ä¸ºæ­£å¼çš„å®šæ—¶ä»»åŠ¡ã€‚

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹çˆ¬è™«æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/solar-crawler.log

# æŸ¥çœ‹æœ€å100è¡Œ
tail -n 100 /var/log/solar-crawler.log

# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
grep "$(date '+%Y-%m-%d')" /var/log/solar-crawler.log
```

### æ—¥å¿—æ–‡ä»¶ç®¡ç†

ä¸ºäº†é¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼Œå»ºè®®é…ç½®æ—¥å¿—è½®è½¬ï¼š

åˆ›å»º `/etc/logrotate.d/solar-crawler`ï¼š

```bash
sudo nano /etc/logrotate.d/solar-crawler
```

æ·»åŠ å†…å®¹ï¼š
```
/var/log/solar-crawler.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    create 0644 root root
}
```

è¿™ä¼šï¼š
- æ¯å¤©è½®è½¬ä¸€æ¬¡æ—¥å¿—
- ä¿ç•™æœ€è¿‘7å¤©çš„æ—¥å¿—
- è‡ªåŠ¨å‹ç¼©æ—§æ—¥å¿—
- ç©ºæ—¥å¿—ä¸è½®è½¬

---

## âœ… éªŒè¯æ•´ä¸ªæµç¨‹æ˜¯å¦æ­£å¸¸å·¥ä½œ

### æ£€æŸ¥æ¸…å•

- [ ] Cronä»»åŠ¡å·²æ·»åŠ ï¼ˆ`crontab -l` å¯ä»¥çœ‹åˆ°ï¼‰
- [ ] çˆ¬è™«èƒ½æˆåŠŸè¿è¡Œï¼ˆæ‰‹åŠ¨è¿è¡Œ `python master_crawler.py now` æ— é”™è¯¯ï¼‰
- [ ] æ•°æ®æ–‡ä»¶ç”ŸæˆæˆåŠŸï¼ˆ`output/individual/` ç›®å½•ä¸‹æœ‰æ–°æ–‡ä»¶ï¼‰
- [ ] Flaskåº”ç”¨æ­£åœ¨è¿è¡Œ
- [ ] è®¿é—®å‰ç«¯é¡µé¢èƒ½çœ‹åˆ°æ•°æ®

### å®Œæ•´æµ‹è¯•æµç¨‹

1ï¸âƒ£ **æ‰‹åŠ¨è¿è¡Œçˆ¬è™«**
```bash
cd /home/user/solar_news_crawler/solar_news_crawler
source ../venv/bin/activate
python master_crawler.py now
```

2ï¸âƒ£ **æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶**
```bash
ls -lht output/individual/
```
ä½ åº”è¯¥çœ‹åˆ°æ–°ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š
- `combined_20241106_120000.json`
- `irena_20241106_120000.json`
- `pvmagazine_20241106_120000.json`
- `iea_20241106_120000.json`
- `translator_20241106_120000.json`

3ï¸âƒ£ **ç­‰å¾…5åˆ†é’Ÿï¼ŒFlaskè‡ªåŠ¨é‡è½½**

æŸ¥çœ‹Flaskåº”ç”¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
ğŸ”„ æ£€æµ‹åˆ°æ–°çš„å›½å†…æ–°é—»æ•°æ®æ–‡ä»¶ï¼Œæ­£åœ¨é‡æ–°åŠ è½½...
âœ… å›½å†…æ–°é—»æ•°æ®å·²æ›´æ–°: 150 æ¡
ğŸ”„ æ£€æµ‹åˆ°æ–°çš„ç¿»è¯‘æ•°æ®æ–‡ä»¶ï¼Œæ­£åœ¨é‡æ–°åŠ è½½...
âœ… ç¿»è¯‘æ–°é—»æ•°æ®å·²æ›´æ–°: 320 æ¡
ğŸ“Š æ•°æ®é‡è½½å®Œæˆ - 2024-11-06 12:05:00
```

4ï¸âƒ£ **è®¿é—®å‰ç«¯é¡µé¢éªŒè¯**

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- å›½å†…æ–°é—»é¡µé¢ï¼š`http://your-domain.com/news_search`
- å›½é™…æ–°é—»é¡µé¢ï¼š`http://your-domain.com/translated_news`

æ£€æŸ¥"æœ€åæ›´æ–°æ—¶é—´"æ˜¯å¦å·²æ›´æ–°åˆ°æœ€æ–°æ—¶é—´ã€‚

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šCronä»»åŠ¡æ²¡æœ‰æ‰§è¡Œ

**æ£€æŸ¥cronæœåŠ¡æ˜¯å¦è¿è¡Œ**ï¼š
```bash
sudo systemctl status cron  # Debian/Ubuntu
sudo systemctl status crond # CentOS/RHEL
```

å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨å®ƒï¼š
```bash
sudo systemctl start cron
sudo systemctl enable cron
```

**æ£€æŸ¥cronæ—¥å¿—**ï¼š
```bash
# Ubuntu/Debian
sudo tail -f /var/log/syslog | grep CRON

# CentOS/RHEL
sudo tail -f /var/log/cron
```

### é—®é¢˜2ï¼šCronè¿è¡Œä½†çˆ¬è™«å¤±è´¥

**æ£€æŸ¥Pythonè·¯å¾„**ï¼š
åœ¨cronä¸­è¿è¡Œçš„ç¯å¢ƒå˜é‡å’Œä½ ç™»å½•åçš„shellä¸åŒï¼Œç¡®ä¿ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚

**æ‰‹åŠ¨æµ‹è¯•å‘½ä»¤**ï¼š
ç›´æ¥å¤åˆ¶cronä¸­çš„å‘½ä»¤åˆ°ç»ˆç«¯è¿è¡Œï¼š
```bash
cd /home/user/solar_news_crawler/solar_news_crawler && /home/user/solar_news_crawler/venv/bin/python master_crawler.py now
```

**æ£€æŸ¥æƒé™**ï¼š
```bash
# ç¡®ä¿æœ‰å†™å…¥æƒé™
ls -ld /home/user/solar_news_crawler/solar_news_crawler/output/individual/
```

### é—®é¢˜3ï¼šæ•°æ®æ–‡ä»¶ç”Ÿæˆäº†ä½†å‰ç«¯æ²¡æ›´æ–°

**æ£€æŸ¥Flaskåº”ç”¨æ˜¯å¦è¿è¡Œ**ï¼š
```bash
ps aux | grep app.py
# æˆ–è€…
ps aux | grep gunicorn
```

**æ£€æŸ¥Flaskæ—¥å¿—**ï¼š
- å¦‚æœä½¿ç”¨ `python app.py`ï¼ŒæŸ¥çœ‹ç»ˆç«¯è¾“å‡º
- å¦‚æœä½¿ç”¨ gunicornï¼ŒæŸ¥çœ‹ç›¸åº”çš„æ—¥å¿—æ–‡ä»¶

**ç¡®è®¤è‡ªåŠ¨é‡è½½çº¿ç¨‹å·²å¯åŠ¨**ï¼š
Flaskå¯åŠ¨æ—¶åº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ”„ è‡ªåŠ¨æ•°æ®é‡è½½çº¿ç¨‹å·²å¯åŠ¨ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
```

### é—®é¢˜4ï¼šChromeé©±åŠ¨é—®é¢˜

å¦‚æœçˆ¬è™«æŠ¥é”™æåˆ°Chromeæˆ–ChromeDriverï¼š

```bash
# å®‰è£…/æ›´æ–°Chrome
sudo apt update
sudo apt install -y chromium-browser chromium-chromedriver

# æ£€æŸ¥Chromeç‰ˆæœ¬
chromium-browser --version
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹çˆ¬è™«æ—¥å¿—ï¼š`tail -f /var/log/solar-crawler.log`
2. æŸ¥çœ‹Flaskåº”ç”¨æ—¥å¿—
3. æ‰‹åŠ¨è¿è¡Œçˆ¬è™«æµ‹è¯•ï¼š`python master_crawler.py now`

---

## ğŸ¯ æ€»ç»“

é…ç½®å®Œæˆåï¼Œæ•´ä¸ªç³»ç»Ÿä¼šè‡ªåŠ¨è¿è¡Œï¼š

```
Cronå®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©2ç‚¹ï¼‰
    â†“
è¿è¡Œçˆ¬è™«ï¼ˆmaster_crawler.py nowï¼‰
    â†“
ç”Ÿæˆæ–°çš„JSONæ•°æ®æ–‡ä»¶
    â†“
Flaskåå°çº¿ç¨‹æ£€æµ‹åˆ°æ–°æ–‡ä»¶ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ï¼‰
    â†“
è‡ªåŠ¨é‡æ–°åŠ è½½æ•°æ®åˆ°å†…å­˜
    â†“
å‰ç«¯ç”¨æˆ·è®¿é—®æ—¶çœ‹åˆ°æœ€æ–°æ•°æ®
```

**ä½ æ— éœ€åšä»»ä½•æ‰‹åŠ¨æ“ä½œï¼Œä¸€åˆ‡éƒ½æ˜¯è‡ªåŠ¨çš„ï¼** ğŸ‰
